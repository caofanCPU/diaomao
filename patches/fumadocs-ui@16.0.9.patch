diff --git a/dist/components/layout/toc-clerk.d.ts.map b/dist/components/layout/toc-clerk.d.ts.map
index 9156ea92f045791b8600661d8dac7ef17e8659bc..aec472b0c2387fea6c5ee0f2668087de2530398e 100644
--- a/dist/components/layout/toc-clerk.d.ts.map
+++ b/dist/components/layout/toc-clerk.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"toc-clerk.d.ts","sourceRoot":"","sources":["../../../src/components/layout/toc-clerk.tsx"],"names":[],"mappings":"AAEA,OAAO,EAAE,KAAK,cAAc,EAA+B,MAAM,OAAO,CAAC;AAOzE,MAAM,CAAC,OAAO,UAAU,aAAa,CAAC,EACpC,GAAG,EACH,SAAS,EACT,GAAG,KAAK,EACT,EAAE,cAAc,CAAC,KAAK,CAAC,2CAsGvB"}
\ No newline at end of file
+{"version":3,"file":"toc-clerk.d.ts","sourceRoot":"","sources":["../../../src/components/layout/toc-clerk.tsx"],"names":[],"mappings":"AAEA,OAAO,EAAE,KAAK,cAAc,EAA0B,MAAM,OAAO,CAAC;AAMpE,MAAM,CAAC,OAAO,UAAU,aAAa,CAAC,EACpC,GAAG,EACH,SAAS,EACT,GAAG,KAAK,EACT,EAAE,cAAc,CAAC,KAAK,CAAC,2CA4BvB"}
\ No newline at end of file
diff --git a/dist/components/layout/toc-clerk.js b/dist/components/layout/toc-clerk.js
index 40f8b2b191cd2817a51de0aaf9c492a3077aac60..f36b807e5eea299e18818b9d938aa506cbaad406 100644
--- a/dist/components/layout/toc-clerk.js
+++ b/dist/components/layout/toc-clerk.js
@@ -1,9 +1,8 @@
 'use client';
-import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
+import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
 import * as Primitive from 'fumadocs-core/toc';
-import { useEffect, useRef, useState } from 'react';
+import { useRef } from 'react';
 import { cn } from '../../utils/cn.js';
-import { TocThumb } from '../../components/layout/toc-thumb.js';
 import { useTOCItems } from '../../components/layout/toc.js';
 import { mergeRefs } from '../../utils/merge-refs.js';
 import { useI18n } from '../../contexts/i18n.js';
@@ -11,51 +10,9 @@ export default function ClerkTOCItems({ ref, className, ...props }) {
     const containerRef = useRef(null);
     const items = useTOCItems();
     const { text } = useI18n();
-    const [svg, setSvg] = useState();
-    useEffect(() => {
-        if (!containerRef.current)
-            return;
-        const container = containerRef.current;
-        function onResize() {
-            if (container.clientHeight === 0)
-                return;
-            let w = 0, h = 0;
-            const d = [];
-            for (let i = 0; i < items.length; i++) {
-                const element = container.querySelector(`a[href="#${items[i].url.slice(1)}"]`);
-                if (!element)
-                    continue;
-                const styles = getComputedStyle(element);
-                const offset = getLineOffset(items[i].depth) + 1, top = element.offsetTop + parseFloat(styles.paddingTop), bottom = element.offsetTop +
-                    element.clientHeight -
-                    parseFloat(styles.paddingBottom);
-                w = Math.max(offset, w);
-                h = Math.max(h, bottom);
-                d.push(`${i === 0 ? 'M' : 'L'}${offset} ${top}`);
-                d.push(`L${offset} ${bottom}`);
-            }
-            setSvg({
-                path: d.join(' '),
-                width: w + 1,
-                height: h,
-            });
-        }
-        const observer = new ResizeObserver(onResize);
-        onResize();
-        observer.observe(container);
-        return () => {
-            observer.disconnect();
-        };
-    }, [items]);
     if (items.length === 0)
         return (_jsx("div", { className: "rounded-lg border bg-fd-card p-3 text-xs text-fd-muted-foreground", children: text.tocNoHeadings }));
-    return (_jsxs(_Fragment, { children: [svg ? (_jsx("div", { className: "absolute start-0 top-0 rtl:-scale-x-100", style: {
-                    width: svg.width,
-                    height: svg.height,
-                    maskImage: `url("data:image/svg+xml,${
-                    // Inline SVG
-                    encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${svg.width} ${svg.height}"><path d="${svg.path}" stroke="black" stroke-width="1" fill="none" /></svg>`)}")`,
-                }, children: _jsx(TocThumb, { containerRef: containerRef, className: "mt-(--fd-top) h-(--fd-height) bg-fd-primary transition-all" }) })) : null, _jsx("div", { ref: mergeRefs(containerRef, ref), className: cn('flex flex-col', className), ...props, children: items.map((item, i) => (_jsx(TOCItem, { item: item, upper: items[i - 1]?.depth, lower: items[i + 1]?.depth }, item.url))) })] }));
+    return (_jsx("div", { ref: mergeRefs(containerRef, ref), className: cn('flex flex-col relative', className), ...props, children: items.map((item, i) => (_jsx(EnhancedClerkTOCItemInternal, { item: item, upperDepth: items[i - 1]?.depth, lowerDepth: items[i + 1]?.depth }, item.url))) }));
 }
 function getItemOffset(depth) {
     if (depth <= 2)
@@ -67,11 +24,74 @@ function getItemOffset(depth) {
 function getLineOffset(depth) {
     return depth >= 3 ? 10 : 0;
 }
-function TOCItem({ item, upper = item.depth, lower = item.depth, }) {
-    const offset = getLineOffset(item.depth), upperOffset = getLineOffset(upper), lowerOffset = getLineOffset(lower);
+function getVisualLinePosition(depth) {
+    return getLineOffset(depth);
+}
+function EnhancedClerkTOCItemInternal({ item, upperDepth = item.depth, lowerDepth = item.depth, }) {
+    const isH3 = item.depth === 3;
+    const rawTitle = typeof item.title === 'string' ? item.title : '';
+    const { isStep, displayStep, content } = getStepInfoFromTitle(rawTitle);
+    let stepNumber = isH3 && isStep ? String(displayStep) : null;
+    let resolvedContent = item.title;
+    if (isH3 && isStep) {
+        resolvedContent = content ?? item.title;
+    }
+    if (isH3 && !stepNumber) {
+        const urlNum = _getDigitsFromUrl(item.url);
+        if (urlNum != null) {
+            const clamped = Math.max(0, Math.min(19, urlNum));
+            stepNumber = String(clamped);
+            if (typeof rawTitle === 'string') {
+                const m = rawTitle.match(/^(\d+(?:\.\d+)*\.?)\s+(.+)$/);
+                if (m && m[2]) {
+                    resolvedContent = m[2];
+                }
+            }
+        }
+    }
+    const shouldRenderCircle = isH3 && stepNumber !== null;
+    const lineOffsetWithinItem = getLineOffset(item.depth);
+    const upperLineOffsetWithinItem = getLineOffset(upperDepth);
+    const lowerLineOffsetWithinItem = getLineOffset(lowerDepth);
+    const itemPadding = getItemOffset(item.depth);
+    const visualElementX = getVisualLinePosition(item.depth);
+    const CIRCLE_RADIUS_PX = 7;
     return (_jsxs(Primitive.TOCItem, { href: item.url, style: {
-            paddingInlineStart: getItemOffset(item.depth),
-        }, className: "prose relative py-1.5 text-sm text-fd-muted-foreground hover:text-fd-accent-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary", children: [offset !== upperOffset ? (_jsx("svg", { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 16 16", className: "absolute -top-1.5 start-0 size-4 rtl:-scale-x-100", children: _jsx("line", { x1: upperOffset, y1: "0", x2: offset, y2: "12", className: "stroke-fd-foreground/10", strokeWidth: "1" }) })) : null, _jsx("div", { className: cn('absolute inset-y-0 w-px bg-fd-foreground/10', offset !== upperOffset && 'top-1.5', offset !== lowerOffset && 'bottom-1.5'), style: {
-                    insetInlineStart: offset,
-                } }), item.title] }));
+            paddingInlineStart: itemPadding,
+        }, className: "prose group relative py-1.5 text-sm text-fd-muted-foreground hover:text-fd-accent-foreground transition-colors [overflow-wrap:anywhere] first:pt-0 last:pb-0 data-[active=true]:text-fd-primary", children: [lineOffsetWithinItem !== upperLineOffsetWithinItem ? (_jsx("svg", { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 16 16", className: "absolute -top-1.5 size-4 pointer-events-none rtl:-scale-x-100", style: {
+                    insetInlineStart: Math.min(lineOffsetWithinItem, upperLineOffsetWithinItem),
+                    zIndex: 1,
+                }, children: _jsx("line", { x1: upperLineOffsetWithinItem -
+                        Math.min(lineOffsetWithinItem, upperLineOffsetWithinItem), y1: "0", x2: lineOffsetWithinItem -
+                        Math.min(lineOffsetWithinItem, upperLineOffsetWithinItem), y2: "12", className: cn('stroke-fd-foreground/10', 'group-data-[active=true]:stroke-fd-primary'), strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }) })) : null, _jsx("div", { className: cn('absolute inset-y-0 pointer-events-none transition-all duration-500 ease-in-out', 'w-[2px] bg-fd-foreground/15 group-data-[active=true]:bg-fd-primary', lineOffsetWithinItem !== upperLineOffsetWithinItem && 'top-1.5', lineOffsetWithinItem !== lowerLineOffsetWithinItem && 'bottom-1.5'), style: {
+                    insetInlineStart: lineOffsetWithinItem,
+                    zIndex: 1,
+                } }), shouldRenderCircle && stepNumber ? (_jsx("span", { className: cn('absolute z-10 flex size-[14px] -translate-y-1/2 items-center justify-center rounded-full', 'bg-black text-white dark:bg-white dark:text-black', 'group-data-[active=true]:bg-fd-primary group-data-[active=true]:text-white dark:group-data-[active=true]:text-black', 'font-medium text-xs'), style: {
+                    left: visualElementX - CIRCLE_RADIUS_PX,
+                    top: '50%',
+                }, children: stepNumber })) : null, _jsx("span", { style: { position: 'relative', zIndex: 1 }, children: resolvedContent })] }));
+}
+function _getDigitsFromUrl(url) {
+    const match = /^#(\d+)-/.exec(url);
+    if (!match)
+        return null;
+    const value = Number.parseInt(match[1], 10);
+    return Number.isNaN(value) ? null : value;
+}
+function getStepInfoFromTitle(title) {
+    const trimmed = title.trim();
+    const match = trimmed.match(/^(\d+(?:\.\d+)*\.?)\s+(.+)$/);
+    if (!match)
+        return { isStep: false, displayStep: null, content: null };
+    const content = (match[2] ?? '').trim();
+    if (content.length === 0)
+        return { isStep: false, displayStep: null, content: null };
+    const numericPart = match[1].replace(/\.$/, '');
+    const parts = numericPart.split('.').map((part) => Number.parseInt(part, 10));
+    const lastPart = parts.at(-1);
+    if (lastPart == null || Number.isNaN(lastPart)) {
+        return { isStep: false, displayStep: null, content: null };
+    }
+    const clamped = Math.max(0, Math.min(19, lastPart));
+    return { isStep: true, displayStep: clamped, content };
 }
