generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model apilog {
  id          BigInt    @id @default(autoincrement())
  method_name String    @db.VarChar(255)
  summary     String?
  request     String?
  response    String?
  api_type    String    @db.VarChar(50)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model credit_usage {
  id             BigInt    @id @default(autoincrement())
  user_id        String    @db.Uuid
  feature        String?   @db.VarChar(255)
  order_id       String?   @db.VarChar(255)
  credit_type    String    @db.VarChar(10)
  operation_type String    @db.VarChar(20)
  credits_used   Int
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  deleted        Int       @default(0)
  users          users     @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([credit_type], map: "idx_credit_usage_credit_type")
  @@index([operation_type], map: "idx_credit_usage_operation_type")
  @@index([order_id], map: "idx_credit_usage_order_id")
  @@index([user_id], map: "idx_credit_usage_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model credits {
  id               BigInt    @id @default(autoincrement())
  user_id          String    @unique @db.Uuid
  balance_free     Int       @default(0)
  total_free_limit Int       @default(0)
  balance_paid     Int       @default(0)
  total_paid_limit Int       @default(0)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  users            users     @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_credits_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model subscriptions {
  id                  BigInt    @id @default(autoincrement())
  user_id             String    @db.Uuid
  pay_subscription_id String?   @db.VarChar(255)
  price_id            String?   @db.VarChar(255)
  price_name          String?   @db.VarChar(255)
  status              String    @default("incomplete") @db.VarChar(20)
  credits_allocated   Int       @default(0)
  sub_period_start    DateTime? @db.Timestamptz(6)
  sub_period_end      DateTime? @db.Timestamptz(6)
  created_at          DateTime? @default(now()) @db.Timestamptz(6)
  updated_at          DateTime? @default(now()) @db.Timestamptz(6)
  deleted             Int       @default(0)
  users               users     @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([pay_subscription_id], map: "idx_subscriptions_pay_subscription_id")
  @@index([user_id], map: "idx_subscriptions_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model transactions {
  id                  BigInt    @id @default(autoincrement())
  user_id             String    @db.Uuid
  order_id            String    @unique @db.VarChar(255)
  order_status        String    @default("created") @db.VarChar(20)
  order_created_at    DateTime? @default(now()) @db.Timestamptz(6)
  order_expired_at    DateTime? @db.Timestamptz(6)
  order_updated_at    DateTime? @default(now()) @db.Timestamptz(6)
  pay_supplier        String?   @db.VarChar(50)
  pay_transaction_id  String?   @unique @db.VarChar(255)
  pay_subscription_id String?   @db.VarChar(255)
  pay_session_id      String?   @db.VarChar(255)
  pay_invoice_id      String?   @db.VarChar(255)
  price_id            String?   @db.VarChar(255)
  price_name          String?   @db.VarChar(255)
  sub_interval_count  Int?
  sub_cycle_anchor    DateTime? @db.Timestamptz(6)
  amount              Decimal?  @db.Decimal(10, 2)
  currency            String?   @db.VarChar(10)
  type                String?   @db.VarChar(20)
  credits_granted     Int?      @default(0)
  sub_period_start    DateTime? @db.Timestamptz(6)
  sub_period_end      DateTime? @db.Timestamptz(6)
  order_detail        String?
  paid_at             DateTime? @db.Timestamptz(6)
  paid_email          String?   @db.VarChar(255)
  paid_detail         String?
  pay_updated_at      DateTime? @db.Timestamptz(6)
  deleted             Int       @default(0)
  users               users     @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([order_id], map: "idx_transactions_order_id")
  @@index([order_status], map: "idx_transactions_order_status")
  @@index([pay_subscription_id], map: "idx_transactions_pay_subscription_id")
  @@index([user_id], map: "idx_transactions_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_backup {
  id               BigInt    @id @default(autoincrement())
  original_user_id String    @db.Uuid
  fingerprint_id   String?   @db.VarChar(255)
  clerk_user_id    String?   @db.VarChar(255)
  email            String?   @db.VarChar(255)
  status           String?   @db.VarChar(50)
  backup_data      Json?
  deleted_at       DateTime? @default(now()) @db.Timestamptz(6)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  deleted          Int       @default(0)

  @@index([clerk_user_id], map: "idx_user_backup_clerk_user_id")
  @@index([email], map: "idx_user_backup_email")
  @@index([fingerprint_id], map: "idx_user_backup_fingerprint_id")
  @@index([original_user_id], map: "idx_user_backup_original_user_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users {
  id             BigInt          @id @default(autoincrement())
  user_id        String          @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  fingerprint_id String?         @db.VarChar(255)
  clerk_user_id  String?         @unique @db.VarChar(255)
  email          String?         @db.VarChar(255)
  status         String          @default("anonymous") @db.VarChar(20)
  created_at     DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at     DateTime?       @default(now()) @db.Timestamptz(6)
  credit_usage   credit_usage[]
  credits        credits?
  subscriptions  subscriptions[]
  transactions   transactions[]

  @@index([fingerprint_id], map: "idx_users_fingerprint_id")
  @@index([status], map: "idx_users_status")
}
